{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "33a8a96e",
   "metadata": {},
   "source": [
    "# Script to Align Multiple AFM and CL Files\n",
    "### 1. Import modules"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ffe7cba4",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import json\n",
    "\n",
    "# === INPUT LISTS (your data) ===\n",
    "cl_files = [\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\session_2025_02_28\\HYP-SI-OLD-LOC1-INSIDE-L-2\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\session_2025_02_28\\HYP-SI-OLD-LOC1-OUTSIDE-L-1\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250321\\HYP-SI-FAT-END-OUTSIDE-03-AFM\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250321\\HYP-SI-FAT-END-OUTSIDE-04-AFM-REDO\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250321\\HYP-SI-FAT-END-OUTSIDE-05-AFM-REDO\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250321\\HYP-SI-FAT-END-OUTSIDE-06-AFM-REDO\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250501\\HYP-SI-FAT-END-OUTSIDE-07\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250501\\HYP-SI-FAT-END-OUTSIDE-08\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250501\\HYP-SI-FAT-END-OUTSIDE-09\\HYPCard_corrected.hspy\",\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250501\\HYP-SI-FAT-END-OUTSIDE-10\\HYPCard_corrected.hspy\"\n",
    "]\n",
    "\n",
    "bkg_files = [\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\session_2025_02_28\\BG-BKG20250228-21ms-2025-02-28-11h29m21s.txt\"\n",
    "] * 2 + [\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250321\\BG-SI-BKG-20ms-2025-03-21-15h10m21s.txt\"\n",
    "] * 4 + [\n",
    "    r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250501\\BG-BKG202050501-10ms-2025-05-01-12h32m44s.txt\"\n",
    "] * 4\n",
    "\n",
    "\n",
    "cl_files += [ \n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND00\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND01\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND02\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND03\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND04\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND05\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND06\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND07\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND08\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND09\\\\HYPCard_corrected.hspy'\n",
    "]\n",
    "\n",
    "bkg_files += [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250707\\BG-BKG-10MS-10ms-2025-07-07-11h43m29s.txt\"] * 10\n",
    "\n",
    "cl_files += [ \n",
    "r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-06-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-07-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-08-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-01\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-02\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-03\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-04\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-04-REDO2\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-05\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-05-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-06\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-07\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-08\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-09\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-10\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND07-REDO700\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND08-REDO700\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND08-REDO7000\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND09-REDO700-2\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND10-REDO700\\HYPCard_corrected.sur\" \n",
    "] \n",
    "\n",
    "bkg_files += [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-10ms-2025-08-05-15h22m09s.txt\"] * 15 \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-700-10ms-2025-08-05-15h37m52s.txt\"] * 2 \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-10ms-2025-08-05-15h22m09s.txt\"] \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-700-10ms-2025-08-05-15h37m52s.txt\"] * 2\n",
    "\n",
    "# === sanity check ===\n",
    "if len(cl_files) != len(bkg_files):\n",
    "    raise ValueError(f\"Mismatch: {len(cl_files)} CL files vs {len(bkg_files)} backgrounds\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "40ad9281",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "# === construct metadata ===\n",
    "manifest = []\n",
    "for cl, bg in zip(cl_files, bkg_files):\n",
    "    manifest.append({\n",
    "        \"cl_file\": os.path.basename(cl).replace(\"HYPCard_corrected\", os.path.basename(os.path.dirname(cl)) + \"_HYPCard\").replace(\".hspy\", \".sur\"),\n",
    "        \"background_file\": os.path.basename(bg)\n",
    "    })\n",
    "\n",
    "# === write JSON ===\n",
    "with open(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\\CL\\metadata\\cl_background_association.json\", \"w\") as f:\n",
    "    json.dump(manifest, f, indent=2)\n",
    "\n",
    "print(\"✅ Metadata JSON written to cl_background_manifest.json\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "11d3dd4c",
   "metadata": {},
   "outputs": [],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "\n",
    "plt.imshow(signal1.data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d159c487",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "405487ed",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import shutil\n",
    "from pathlib import Path\n",
    "\n",
    "folder_a = Path(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\\CL\\hyperspectral_cubes\")\n",
    "folder_b = Path(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\")\n",
    "folder_c = Path(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\\CL\\metadata\")\n",
    "folder_c.mkdir(parents=True, exist_ok=True)\n",
    "\n",
    "for npy_file in folder_a.glob(\"*_CL_SEM.npy\"):\n",
    "    base = npy_file.stem.replace(\"_CL_SEM\", \"\")  # e.g. SAMPLE123\n",
    "    matches = list(folder_b.glob(f\"*/{base}/MicroscopeStatus.txt\"))\n",
    "\n",
    "    if len(matches) == 0:\n",
    "        print(f\"⚠️ No MicroscopeStatus.txt found for {npy_file.name}\")\n",
    "    elif len(matches) > 1:\n",
    "        print(f\"⚠️ Multiple matches for {npy_file.name}:\")\n",
    "        for m in matches:\n",
    "            print(f\"   - {m}\")\n",
    "    else:\n",
    "        src = matches[0]\n",
    "        dst = folder_c / f\"{base}_MicroscopeStatus.txt\"\n",
    "        shutil.copy2(src, dst)\n",
    "        print(f\"✅ Copied {src} -> {dst}\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9739278c",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import shutil\n",
    "from pathlib import Path\n",
    "\n",
    "# set your paths\n",
    "folder_A = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\\CL\\hyperspectral_cubes\"\n",
    "folder_B = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\numpy_fits\"\n",
    "folder_C = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\\CL\\gaussian_fits\"\n",
    "folder_D = Path(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\")\n",
    "\n",
    "\n",
    "for fname in os.listdir(folder_A):\n",
    "    if fname.endswith(\"_CL_SEM.npy\"):\n",
    "        prefix = fname.replace(\"_CL_SEM.npy\", \"\")\n",
    "        centre_name = prefix + \"_m_centre.npy\"\n",
    "        intensity_name = prefix + \"_m_intensity.npy\"\n",
    "        fwhm_name = prefix + \"_m_fwhm.npy\"\n",
    "        centre_src = os.path.join(folder_B, centre_name)\n",
    "        centre_dst = os.path.join(folder_C, centre_name)\n",
    "        intensity_src = os.path.join(folder_B, intensity_name)\n",
    "        intensity_dst = os.path.join(folder_C, intensity_name)\n",
    "        fwhm_src = os.path.join(folder_B, fwhm_name)\n",
    "        fwhm_dst = os.path.join(folder_C, fwhm_name)\n",
    "\n",
    "        if os.path.exists(centre_src):\n",
    "            print('Already copied ' + fname)\n",
    "            continue\n",
    "            print(f\"Copying {centre_src} -> {centre_dst}\")\n",
    "            shutil.copy2(centre_src, centre_dst)\n",
    "        else:\n",
    "            print(f\"⚠️ Missing centre file for {fname}\")\n",
    "            matches = list(folder_D.glob(f\"*/{prefix}/HYPCard_corrected_m_centre.hspy\"))\n",
    "            if len(matches) == 1:\n",
    "                print(f\"Found matching centre file for {fname}: {matches[0]}\")\n",
    "                signal1 = hs.load(matches[0]).data\n",
    "                np.save(centre_dst, signal1)\n",
    "            elif len(matches) > 1:\n",
    "                print(f\"⚠️ Multiple matching centre files found for {fname}:\")\n",
    "                for match in matches:\n",
    "                    print(f\" - {match}\")\n",
    "            else:\n",
    "                print(f\"⚠️ No matching centre file found for {fname}\")\n",
    "\n",
    "        if os.path.exists(intensity_src):\n",
    "            print(f\"Copying {intensity_src} -> {intensity_dst}\")\n",
    "            shutil.copy2(intensity_src, intensity_dst)\n",
    "        else:\n",
    "            print(f\"⚠️ Missing intensity file for {fname}\")\n",
    "            matches = list(folder_D.glob(f\"*/{prefix}/HYPCard_corrected_m_intensity.hspy\"))\n",
    "            if len(matches) == 1:\n",
    "                print(f\"Found matching intensity file for {fname}: {matches[0]}\")\n",
    "                signal1 = hs.load(matches[0]).data\n",
    "                np.save(intensity_dst, signal1)\n",
    "            elif len(matches) > 1:\n",
    "                print(f\"⚠️ Multiple matching intensity files found for {fname}:\")\n",
    "                for match in matches:\n",
    "                    print(f\" - {match}\")\n",
    "            else:\n",
    "                print(f\"⚠️ No matching intensity file found for {fname}\")\n",
    "\n",
    "        if os.path.exists(fwhm_src):\n",
    "            print(f\"Copying {fwhm_src} -> {fwhm_dst}\")\n",
    "            shutil.copy2(fwhm_src, fwhm_dst)\n",
    "        else:\n",
    "            print(f\"⚠️ Missing FWHM file for {fname}\")\n",
    "            matches = list(folder_D.glob(f\"*/{prefix}/HYPCard_corrected_m_fwhm.hspy\"))\n",
    "            if len(matches) == 1:\n",
    "                print(f\"Found matching FWHM file for {fname}: {matches[0]}\")\n",
    "                signal1 = hs.load(matches[0]).data\n",
    "                np.save(fwhm_dst, signal1)\n",
    "            elif len(matches) > 1:\n",
    "                print(f\"⚠️ Multiple matching FWHM files found for {fname}:\")\n",
    "                for match in matches:\n",
    "                    print(f\" - {match}\")\n",
    "            else:\n",
    "                print(f\"⚠️ No matching FWHM file found for {fname}\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dbe5651a",
   "metadata": {},
   "source": [
    "## Manually Defined Lists from HF Database"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "b9a0f26d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os \n",
    "base_filepath = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\HF_Database\"\n",
    "\n",
    "# Manually defined lists\n",
    "afm_files = [\n",
    "    \"fat_end_outside_L_03.0_00000.spm\",\n",
    "    \"fat_end_outside_L_04.0_00000.spm\",\n",
    "    \"fat_end_outside_L_05.0_00000.spm\",\n",
    "    \"fat_end_outside_L_06.0_00000.spm\",\n",
    "    \"fat_end_outside_L_07.0_00000.spm\",\n",
    "    \"fat_end_outside_L_08.0_00000.spm\",\n",
    "    \"fat_end_outside_L_09.0_00000.spm\",\n",
    "    \"fat_end_outside_L_10.0_00000.spm\",\n",
    "    \"short_end_01.0_00000.spm\",\n",
    "    \"short_end_02.0_00000.spm\",\n",
    "    \"short_end_03.0_00000.spm\",\n",
    "    \"short_end_04.0_00000.spm\",\n",
    "    \"short_end_05.0_00000.spm\",\n",
    "    \"short_end_06.0_00000.spm\",\n",
    "    \"short_end_07.0_00000.spm\",\n",
    "    \"short_end_08.0_00000.spm\",\n",
    "    \"short_end_09.0_00000.spm\",\n",
    "    \"short_end_10.0_00000.spm\",\n",
    "    \"Si_L_longend_01.0_00000_game.spm\",\n",
    "    \"Si_L_longend_01.0_00001_2.spm\",\n",
    "    \"Si_L_longend_01.0_00002_game.spm\",\n",
    "    \"Si_L_longend_05.0_00000_game.spm\",\n",
    "    \"Si_L_longend_06.0_00000_game.spm\",\n",
    "    \"Si_L_longend_07.0_00000_game.spm\",\n",
    "    \"Si_L_longend_09.0_00000_game.spm\",\n",
    "    \"si_old_zoomed_02.0_00000_grey.spm\",\n",
    "    \"si_old_zoomed_03.0_00000_grey.spm\",\n",
    "]\n",
    "\n",
    "cl_files = [\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-03-AFM_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-04-AFM-REDO_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-05-AFM-REDO_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-06-AFM-REDO_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-07_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-08_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-09_HYPCard.sur\",\n",
    "    \"HYP-SI-FAT-END-OUTSIDE-10_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-01_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-02_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-03_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-04-REDO2_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-05-REDO_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND-06_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND07-REDO700_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND08-REDO700_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND09-REDO700-2_HYPCard.sur\",\n",
    "    \"HYP-SHORTEND10-REDO700_HYPCard.sur\",\n",
    "    \"HYP-LONGEND00_HYPCard.sur\",\n",
    "    \"HYP-LONGEND01_HYPCard.sur\",\n",
    "    \"HYP-LONGEND02_HYPCard.sur\",\n",
    "    \"HYP-LONGEND05_HYPCard.sur\",\n",
    "    \"HYP-LONGEND-06-REDO_HYPCard.sur\",\n",
    "    \"HYP-LONGEND-07-REDO_HYPCard.sur\",\n",
    "    \"HYP-LONGEND09_HYPCard.sur\",\n",
    "    \"HYP-SI-OLD-LOC1-INSIDE-L-2_HYPCard.sur\",\n",
    "    \"HYP-SI-OLD-LOC1-OUTSIDE-L-1_HYPCard.sur\",\n",
    "]\n",
    "\n",
    "# Generate alignment filenames: CLBASENAME_AFMBASENAME.csv\n",
    "alignment_files = [\n",
    "    os.path.join(base_filepath, \"Alignment\", \"CSVs\", f\"{os.path.splitext(cl)[0][:-8]}_{os.path.splitext(afm)[0]}.csv\")\n",
    "    for cl, afm in zip(cl_files, afm_files)\n",
    "]\n",
    "\n",
    "afm_files = [os.path.join(base_filepath, \"AFM\", \"raw\", afm) for afm in afm_files]\n",
    "cl_files = [os.path.join(base_filepath, \"CL\", \"raw_sur_files\", cl) for cl in cl_files]\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "# Example loop\n",
    "# for afm_file, cl_file, alignment_file in zip(afm_files, cl_files, alignment_files):\n",
    "#     print(f\"AFM: {afm_file}, CL: {cl_file}, ALIGN: {alignment_file}\")\n",
    "#     afm_file_exists = os.path.exists(afm_file)\n",
    "#     cl_file_exists = os.path.exists(cl_file)\n",
    "#     alignment_file_exists = os.path.exists(alignment_file)\n",
    "#     print(f\"AFM exists: {afm_file_exists}, CL exists: {cl_file_exists}, Alignment exists: {alignment_file_exists}\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "6a8d352b",
   "metadata": {},
   "outputs": [],
   "source": [
    "import lumispy as lum\n",
    "import hyperspy.api as hs\n",
    "hs.preferences.General.plot_backend = \"mpl\"\n",
    "import hyperspy.api as hs\n",
    "import os\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import cv2\n",
    "\n",
    "%matplotlib widget"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6eccacd9",
   "metadata": {},
   "source": [
    "### 2. Set filenames"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "cfcc05ad",
   "metadata": {},
   "outputs": [],
   "source": [
    "afm_files = ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\19_02_2025\\\\si_old_zoomed_02.0_00000_grey.png',\n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\19_02_2025\\\\si_old_zoomed_03.0_00000_grey.png',\n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_03.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_04.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_05.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_06.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_07.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_08.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_09.0_00000.png', \n",
    "             'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\07_03_2025\\\\fat_end_outside_L_10.0_00000.png']\n",
    "\n",
    "cl_files = ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\session_2025_02_28\\\\HYP-SI-OLD-LOC1-INSIDE-L-2\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\session_2025_02_28\\\\HYP-SI-OLD-LOC1-OUTSIDE-L-1\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250321\\\\HYP-SI-FAT-END-OUTSIDE-03-AFM\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250321\\\\HYP-SI-FAT-END-OUTSIDE-04-AFM-REDO\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250321\\\\HYP-SI-FAT-END-OUTSIDE-05-AFM-REDO\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250321\\\\HYP-SI-FAT-END-OUTSIDE-06-AFM-REDO\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI-20250501\\\\HYP-SI-FAT-END-OUTSIDE-07\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI-20250501\\\\HYP-SI-FAT-END-OUTSIDE-08\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI-20250501\\\\HYP-SI-FAT-END-OUTSIDE-09\\\\HYPCard_corrected.hspy',\n",
    "            'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI-20250501\\\\HYP-SI-FAT-END-OUTSIDE-10\\\\HYPCard_corrected.hspy']\n",
    "\n",
    "bkg_files = ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\session_2025_02_28\\\\BG-BKG20250228-21ms-2025-02-28-11h29m21s.txt'] * 2 \\\n",
    "          + ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250321\\\\BG-SI-BKG-20ms-2025-03-21-15h10m21s.txt'] * 4 \\\n",
    "          + ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI-20250501\\\\BG-BKG202050501-10ms-2025-05-01-12h32m44s.txt'] * 4\n",
    "\n",
    "alignment_files = ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates.csv',\n",
    "                   'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates2.csv',\n",
    "                   'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates3.csv',\n",
    "                   'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates4.csv',\n",
    "                   'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates5.csv',\n",
    "                   'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates6.csv',\n",
    "                     'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates7.csv',\n",
    "                     'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates8.csv',\n",
    "                        'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates9.csv',\n",
    "                        'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates10.csv']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "67562e75",
   "metadata": {},
   "outputs": [],
   "source": [
    "afm_files = [\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_01.0_00000_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_01.0_00001_2.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_01.0_00002_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_01.0_00003_game_gunk.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_04_v2.0_00005_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_05.0_00000_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_06.0_00000_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_07.0_00000_game.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_08.0_00000_game_gunk.png',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\AFM\\\\25_06_2025\\\\Si_L_longend_09.0_00000_game.png'\n",
    "]\n",
    "\n",
    "cl_files = [\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND00\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND01\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND02\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND03\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND04\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND05\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND06\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND07\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND08\\\\HYPCard_corrected.hspy',\n",
    "    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\CL\\\\COBI20250707\\\\HYP-LONGEND09\\\\HYPCard_corrected.hspy'\n",
    "]\n",
    "\n",
    "bkg_files = [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250707\\BG-BKG-10MS-10ms-2025-07-07-11h43m29s.txt\"] * 10\n",
    "\n",
    "# alignment_files = ['C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates1.csv',\n",
    "#                    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates2.csv',\n",
    "#                    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates3.csv',\n",
    "#                    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates4.csv',\n",
    "#                    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates5.csv',\n",
    "#                    'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates6.csv',\n",
    "#                      'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates7.csv',\n",
    "#                      'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates8.csv',\n",
    "#                         'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates9.csv',\n",
    "#                         'C:\\\\Users\\\\cobia\\\\OneDrive - University of Cambridge\\\\image_alignment\\\\click_coordinates10.csv']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "74347866",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "\n",
    "alignment_files = [os.path.join(r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\image_alignment\", os.path.splitext(os.path.basename(file))[0] + \".csv\") for file in afm_files]\n",
    "alignment_files[1] = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\image_alignment\\Si_L_longend_01.0_00001_game_2.csv\"\n",
    "alignment_files"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0276f4de",
   "metadata": {},
   "outputs": [],
   "source": [
    "bkg_files = [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI20250707\\BG-BKG-10MS-10ms-2025-07-07-11h43m29s.txt\"] * 10"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f3b9bf94",
   "metadata": {},
   "outputs": [],
   "source": [
    "cl_files = [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-01\\HYPCard_corrected.hspy\"]\n",
    "bkg_files = [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-10ms-2025-08-05-15h22m09s.txt\"]   "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0873f99b",
   "metadata": {},
   "outputs": [],
   "source": [
    "numpy_folder = r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\numpy_fits\"\n",
    "os.path.join(numpy_folder, \"afm_only_models\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "17ae36da",
   "metadata": {},
   "outputs": [],
   "source": [
    "cl_files[0].split(os.path.sep)[-2]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d07f2793",
   "metadata": {},
   "outputs": [],
   "source": [
    "cl_files = [ \n",
    "r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-06-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-07-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-LONGEND-08-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-01\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-02\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-03\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-04\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-04-REDO2\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-05\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-05-REDO\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-06\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-07\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-08\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-09\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND-10\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND07-REDO700\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND08-REDO700\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND08-REDO7000\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND09-REDO700-2\\HYPCard_corrected.sur\" \n",
    ",r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\HYP-SHORTEND10-REDO700\\HYPCard_corrected.sur\" \n",
    "] \n",
    "\n",
    "bkg_files = [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-10ms-2025-08-05-15h22m09s.txt\"] * 15 \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-700-10ms-2025-08-05-15h37m52s.txt\"] * 2 \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-10ms-2025-08-05-15h22m09s.txt\"] \\\n",
    "+ [r\"C:\\Users\\cobia\\OneDrive - University of Cambridge\\CL\\COBI-20250804\\BG-10MSBKG20250805-700-10ms-2025-08-05-15h37m52s.txt\"] * 2"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3f6ac798",
   "metadata": {},
   "source": [
    "### 3. If HYPCard_corrected files don't exist, create them from HYPCard"
   ]
  }
 ],
 "metadata": {},
 "nbformat": 4,
 "nbformat_minor": 5
}
